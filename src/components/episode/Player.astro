---
import ErrorBoundary from '../common/ErrorBoundary.astro';
import AudioPlayer from '../react/AudioPlayer';
import { validateProps, EpisodePlayerPropsSchema } from '~/utils/component-validation';

interface Props {
  audio_url: string;
  title: string;
  description?: string;
}

// Validate props
const props = validateProps(EpisodePlayerPropsSchema, Astro.props);
const { audio_url, title, description } = props;

// Ensure the title is properly escaped for use in aria-label
const escapedTitle = title.replace(/"/g, '&quot;');
---

<ErrorBoundary fallback="Audio player unavailable. Please try again later.">
  <div class="episode-player">
    <div class="audio-container">
      <AudioPlayer client:load {audio_url} {title} {escapedTitle} />
    </div>
    {description && (
      <div class="episode-description">
        <p>{description}</p>
      </div>
    )}
  </div>
</ErrorBoundary>

<style>
.episode-player {
  @apply w-full max-w-3xl mx-auto my-4 rounded-lg overflow-hidden
         shadow-lg bg-white dark:bg-gray-800;
}

.audio-container {
  @apply p-4;
}

.audio-player {
  @apply w-full;
}

.episode-description {
  @apply p-4 text-sm text-gray-600 dark:text-gray-300;
}
</style>
