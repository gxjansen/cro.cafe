---
import ErrorBoundary from '../common/ErrorBoundary.astro';
import { validateProps, EpisodePlayerPropsSchema } from '~/utils/component-validation';

interface Props {
  episodeId: string;
  title: string;
  description?: string;
}

// Validate props
const props = validateProps(EpisodePlayerPropsSchema, Astro.props);
const { episodeId, title, description } = props;

// Ensure the title is properly escaped for use in aria-label
const escapedTitle = title.replace(/"/g, '&quot;');
---

<ErrorBoundary fallback="Audio player unavailable. Please try again later.">
  <div class="episode-player">
    <iframe
      width="100%"
      height="180"
      frameborder="no"
      scrolling="no"
      seamless
      src={`https://share.transistor.fm/e/${episodeId}`}
      title={title}
      aria-label={`Podcast episode player: ${escapedTitle}`}
      class="w-full"
    />
    {description && (
      <div class="episode-description">
        <p>{description}</p>
      </div>
    )}
  </div>
</ErrorBoundary>

<style>
.episode-player {
  @apply w-full max-w-3xl mx-auto my-4 rounded-lg overflow-hidden
         shadow-lg bg-white dark:bg-gray-800;
}

.episode-description {
  @apply p-4 text-sm text-gray-600 dark:text-gray-300;
}
</style>
